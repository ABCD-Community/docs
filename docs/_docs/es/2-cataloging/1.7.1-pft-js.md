---
title: Agregar un javascript a la presentación de los registros en el módulo de catalogación
permalink: /docs/es/2-cataloging/pft-js
lang: es
key: docs-pft-js-es
---

## Agregar un javascript

En la carpeta bases/www existe un formato denominado **prologoact.pft** donde se forma el encabezamiento del registro presentado en el área de catalogación. Este pft puede ser utilizado para agregar scripts y archivos de estilo que modifiquen la presentación de los registros que se muestran en el proceso de catalogación. Los scripts agregados en **prologoact.pft** pueden ser luego referenciados desde el formato que presenta el registro en la ventana de catalogación. Por ejemplo: si quiere agregar un script para colapsar alqunas secciones del registro desplegado en la pantalla (ejm. Tabla de contenido, resumen o existencias) siga el siguiente procedimiento:

- Incluya en **prologoact.pft** los estilos que servirán para hacer visible/invisible la sección del documento que desea colapsar:

```
         <style type="text/css">
           #i_division 
              {text-align:left;
               margin:0 auto;
               width:100%;
               padding:0px;
              }
         </style>
```

- Incluya en **prologoact.pft** el script que permite colapsar (esconder) una división (div) del documento:

```
         <script>
             function Colapsar(obj) {      
                 var el = document.getElementById(obj);
                 if ( el.style.display != "none" ) {
                    el.style.display = "none";
                 }else {
                    el.style.display = "";
                 }
             }
         </script>
```

Recuerde que como estamos insertando el estilo y el javascript en formatos Isis, tenemos que colocar ambos bloques encerrados entre apóstrofes (' ... '), o sea, prologoact.pft nos quedará de la siguiente manera:

```
         '<style type="text/css">
            #i_division {
               text-align:left;
               margin:0 auto;
               width:100%;
               padding:0px;
            }
          </style>'/
          
         '<script>
             function Colapsar(obj) {      
                 var el = document.getElementById(obj);
                 if ( el.style.display != "none" ) {
                    el.style.display = "none";
                 }else {
                    el.style.display = "";
                 }
              }
          </script>'/
```

**No olvidar el / al final del formato**

- Modifique el formato de despliegue del registro para crear divisiones con las secciones que desea colapsar, e incluya el llamado al javascript que hace las divisiones visibles/invisibles:

```
          if  p(v72)  then
            `<div id="i_division">
               <a onclick="Colapsar('mytc_` f(mfn,1,0) `');" style="text-decoration:none ">
               <strong>Resumen</strong></a>
               <div id='mytc_` f(mfn,1,0) `'" style="display:none">`/
                   v72+|<br>|,
               '</div>
             </div>'/    
          fi/
```

Nótese el uso de las comillas **`** que se usan para indicar el literal incondicional por cuanto para elaborar el formato que invoca al javascript se están usando el apóstrofe y la comilla para cumplir con las normas de sintaxis exigidas en HTML


Este formato hace lo siguiente:

- - Si está presente el resumen (if p(v72)) crea una division con el estilo establecido en i_division
  - Al interior de esa divisón coloca un link (<a onclik=) al javascript Colapsar al cual se le envía el nombre de la sección que se desea colapsar.
  - Hay que asegurarse que cada sección tenga su propio nombre. Por eso el nombre de la división se construye con el nombre genérico mytc_ y se le agrega el mfn del registro: f(mfn,1,0).
  - Luego se crea la division con el mismo nombre que se le envió al javascript Colapsar y se le coloca como estilo style="display:none" para que cuando se abra la página se muestre escondido.
  - Se construye con el lenguaje de formatos el despliegue del o los campos correspondientes
  - Se cierran las dos divisiones que se abrieron.


Esta secuencia introducirá en la hoja de presentación la siguiente salida:

```
           <div id="i_division">
               <a onclick="Colapsar('mytc_1');" style="text-decoration:none ">
                <strong>Resumen</strong></a>
               <div id='mytc_1'" style="display:none">
                  Texto del resumen ...  
               </div>
           </div>
```

Si el formato modificado va a ser utilizado en el IAH, debe agregar el estilo y el javascript en el formato ahhead.pft localizado en \abcd\www\htdocs\iah\scripts\es\



```
    Ver el formato prologoact.pft de la carpeta demo sin copias
    Ver el formato donde se utiliza el código javascript del formato prologoact.pft
```



---

## Javascript

### Para presentar un campo con subcampos repetibles

El lenguaje de formatos de CDS/Isis no brinda opciones para presentar campos con subcampos repetibles, a menos que se utilizen los modos MDU y MHU, que nos insertan delimitadores pre-definidos para separar los subcampos.


Se incluye aquí un sencillo script que puede colocarse en cualquier formato de salida cuando se desee presentar un campo, repetible o no, que posea en su interior, subcampos repetibles. Insertado en el lugar donde va el campo nos produce el efecto deseado:

```
          '<script>
              campo="'v16+|$$$|'"
              occ=campo.split("$$$")
              limite=occ.length
              for (ix_occ=0;ix_occ<limite;ix_occ++){
                  campo=occ[ix_occ]
                  c=campo.split("^")
                  total=c.length-1
                  for (ix=0;ix<=total;ix++){
                      if (c[ix]!=""){
                          document.writeln(c[ix].substr(1))
                          if (ix!=total)
                               document.writeln(" -- ")
                      }
                  }
                  document.writeln("<br>")
              }
           </script>
          '
```

**Explicación**:

Todo el script tiene que agregarse como si fuera un literal incondicional, es decir, encerrado entre apóstrofes

| campo="'vxx+\|$$$\|'"                     | Inserta el campo a formatear, separando las ocurrencias con $$$ (xx=tag del campo) |
| ----------------------------------------- | ------------------------------------------------------------ |
| occ=campo.split("$$$")                    | Convierte el campo en un arreglo                             |
| limite=occ.length                         | Obtiene el número de elementos del arreglo                   |
| for (ix_occ=0;ix_occ<limite;ix_occ++){    | Recorre los elementos del arreglo (ocurrencias del campo repetible) |
| campo=occ[ix_occ]                         | Obtiene un elemento del arreglo (ocurrencia)                 |
| c=campo.split("^")                        | Genera un arreglo donde cada subcampo es una fila            |
| total=c.length-1                          | Determina el número de subcampos (se cuenta desde 0)         |
| for (ix=0;ix<=total;ix++){                | Recorre las filas del arreglo (subcampos)                    |
| if (c[ix]!=""){                           | Revisa a ver si la fila no está vacía (como la ocurrencia del campo viene en la forma ^a ... ^b, la primera fila está vacía porque no tiene nada que la preceda) |
| document.writeln(c[ix].substr(1))         | Si la fila no está vacía la coloca en la página              |
| if (ix!=total)   document.writeln(" -- ") | Si no es el último subcampo, coloca un delimitador en la página |
| document.writeln("<br>")                  | Terminó de procesar los subcampos de una ocurrencia. Por lo tanto, inserta el separador de las ocurrencias |

Sustituya los delimitadores " -- " y "<br>" por aquellos que correspondan a la presentación que Ud. está preparando. No olvide colocar las comillas.

Puede incluir este script tantas veces como campos con subcampos repetibles quiera presentar.

**Para usuarios avanzados**.

Este script puede ser una función que reciba el valor a presentar y devuelva el valor formateado. En este caso, incluya en el formato www/prologoact.pft la función que prepara la salida e incluya donde así lo necesite la llamada a la función.

**Ejemplo**:

Incluya en **prologoact.pft** la siguiente función:

```
    '<script>
         function FormatearSubcamposRepetibles(campo,sep_sc,sep_occ){
             resultado=""   
             occ=campo.split("$$$")
             limite=occ.length
             for (ix_occ=0;ix_occ<limite;ix_occ++){
                 campo=occ[ix_occ]
                 c=campo.split("^")
                 total=c.length-1
                 for (ix=0;ix<=total;ix++){
                     if (c[ix]!=""){
                         resultado+=c[ix].substr(1)
                         if (ix!=total)
                            resultado+=sep_sc
                     }
                 }
                 resultado+=sep_occ
             }
             return resultado
         }
      </script>
     '
```

y en la pft con el formato, cada vez que desee presentar un campo con subcampos repetibles, incluya:

```
      '<script>
          salida=FormatearSubcamposRepetibles("'vxx+|$$$|'"," -- ","<br>")
          document.writeln(salida)
       </script>
      '
```

Se envían como parámetros el campo, el delimitador a colocar entre los subcampos y el delimitador con el cual separar las ocurencias.

Si este formato va a ser utilizado en el IAH y se utiliza el llamado de la función FormatearSubcamposRepetibles, recuerde entonces incluir el Script con la función en el formato ahhead.php localizado en la carpeta htdocs/iah/scripts.


---

### Para presentar un campo con subcampos repetibles, permitiendo presentar cada subcampo con comandos específicos de HTML

Este procedimiento es una ampliación de "[Utilizar un javascript para presentar un campo con subcampos repetibles](https://www.mediawiki.org/w/index.php?title=Utilizar_un_javascript_para_presentar_un_campo_con_subcampos_repetibles&action=edit&redlink=1)" ya que permite variar la forma como se presentan los subcampos repetibles de un registro, insertando diferentes comandos HTML dependiendo del delimitador del subcampo.

Supongamos que en nuestro registro tenemos el campo 12 con el siguiente contenido:

```
12^lhttp://www.aecr.org/images/ImatgesArticles/2010/6/01_RAQUEL.pdf^aThe Woodlands : una forma 
  diferente de gobernar^p5-28^qInsa-Ciriza, R.
12^lhttp://www.aecr.org/images/ImatgesArticles/2010/6/02_MANUEL.pdf^aInfluencia de 
  las dimensiones de la capacidad de absorción en el desarrollo de  nuevos productos en un
  contexto de distrito industrial. Un estudio empírico al caso del textil valenciano
  ^p29-50^qExpósito, M.^qMolina, F.^qCapó, J.
```

como puede apreciarse el subcampo q es repetible y el subcampo l contiene una URL por lo que se necesita presentarlo a través del comando HREF del lenguaje HTML.


En estas condiciones, el script a utilizar para presentar el campo tiene la siguiente forma:

```
    '<script>
        campo="'v12+|$$$|'"
        occ=campo.split("$$$")
        limite=occ.length
        for (ix_occ=0;ix_occ<limite;ix_occ++){
           campo=occ[ix_occ]
           c=campo.split("^")
           total=c.length-1
           for (ix=0;ix<=total;ix++){
               if (c[ix]!=""){
                  /* Colocar primero el subcampo l que tiene la URL del articulo
                     para que el título aparezca como un link al texto completo,
                     anteponer el subcampo l al subcampo a.*/
                  if(c[ix].substring(0,1)=="l"){
                     document.writeln("<a href=\"")
                  }
                  /* Con la siguiente línea el subcampo a sale en negrita y a su vez 
                     cierra el tag del a href */
                  if(c[ix].substring(0,1)=="a"){
                     document.writeln("\"><b> ")
                  }
                  /* El subcampo p, páginas, cierra el tag del enlace, cierra la negrita
                     y pone el literal de  Pag.*/
                  if(c[ix].substring(0,1)=="p"){
                    document.writeln("</a></b>. Pag. ")
                  }
                  /* Se separan los autores con ; */
                  if(c[ix].substring(0,1)=="q"){
                     document.writeln(c[ix].substr(1))
                     if (ix!=total) document.writeln(" ;  ")
                  }
               }
           }
           document.writeln("<br>")
        }
    </script>
    '
```

Cortesía de Daniel Biset: dbiset@yahoo.com
